<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn tập từ vựng tiếng Anh - Lớp học</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Comic Sans', cursive;
            background-color: #e0f7fa;
            color: #004d40;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            background-color: #ffffff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        h1 {
            color: #00796b;
            text-shadow: 2px 2px 4px #b2dfdb;
            margin-bottom: 20px;
        }
        .star-container {
            margin: 20px 0;
            font-size: 2.5em;
            color: #cfd8dc;
        }
        .star {
            cursor: pointer;
            transition: color 0.3s;
        }
        .star.completed {
            color: #ffc107;
        }
        .section {
            display: none;
            padding: 20px;
            border: 2px solid #b2dfdb;
            border-radius: 15px;
            margin-top: 20px;
        }
        .section.active {
            display: block;
        }
        .nav-buttons {
            margin-top: 20px;
        }
        .nav-button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            background-color: #00796b;
            color: white;
            transition: background-color 0.3s;
            margin: 0 5px;
        }
        .nav-button:hover {
            background-color: #004d40;
        }
        
        /* Section 1: Vocabulary */
        .vocabulary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .vocab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background-color: #e0f2f1;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .vocab-item:hover {
            transform: scale(1.05);
        }
        .vocab-item .word {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
        }
        .vocab-item .icon {
            font-size: 2.5em;
        }
        
        /* Section 2: Match */
        .match-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
        }
        .match-words, .match-images {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 200px;
            padding: 10px;
            border: 2px dashed #00796b;
            border-radius: 10px;
            background-color: #f1f8e9;
        }
        .draggable-word {
            padding: 10px;
            background-color: #c8e6c9;
            border-radius: 8px;
            cursor: grab;
            transition: transform 0.1s;
        }
        .image-box {
            width: 150px;
            height: 150px;
            background-color: #ffffff;
            border: 2px solid #81c784;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .image-box img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 6px;
        }
        .image-box.correct {
            border-color: #4caf50;
            background-color: #e8f5e9;
        }
        .match-image-label {
            position: absolute;
            bottom: -25px;
            font-weight: bold;
            color: #004d40;
        }

        /* Section 3: Fill in the blank */
        .fill-in-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .fill-in-word {
            display: flex;
            gap: 5px;
            font-size: 2em;
        }
        .fill-in-letter {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1em;
            border: 2px solid #00796b;
            border-radius: 5px;
            text-transform: lowercase;
        }
        .fill-in-letter:read-only {
            background-color: #e0f2f1;
            border-color: #004d40;
        }
        .fill-in-check-btn {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 10px;
        }

        /* Section 4: Word Search */
        .word-search-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .word-search-grid {
            display: grid;
            border: 2px solid #004d40;
            margin-top: 15px;
            background-color: #e8f5e9;
        }
        .word-search-cell {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #b2dfdb;
            cursor: pointer;
            font-size: 1.2em;
            text-transform: uppercase;
            user-select: none;
        }
        .word-search-cell.highlight {
            background-color: #a5d6a7;
            color: white;
        }
        .word-search-word-list {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .found-word {
            text-decoration: line-through;
            color: #9e9e9e;
        }

        /* Section 5: Quiz */
        .quiz-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .quiz-question img {
            max-width: 200px;
            border: 4px solid #00796b;
            border-radius: 10px;
        }
        .quiz-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .quiz-option {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            border: 2px solid #b2dfdb;
            border-radius: 10px;
            background-color: #e0f2f1;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .quiz-option:hover {
            background-color: #b2dfdb;
        }
        .quiz-option.correct {
            background-color: #a5d6a7;
            border-color: #4caf50;
        }
        .quiz-option.incorrect {
            background-color: #ffcdd2;
            border-color: #f44336;
        }

        /* Section 6: Scramble */
        .scramble-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .scramble-letters {
            display: flex;
            gap: 10px;
        }
        .scramble-letter {
            padding: 15px;
            font-size: 1.5em;
            font-weight: bold;
            background-color: #c8e6c9;
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            cursor: pointer;
        }
        .scramble-target-word {
            height: 60px;
            border: 2px dashed #00796b;
            border-radius: 10px;
            padding: 10px;
            min-width: 200px;
            display: flex;
            gap: 5px;
            justify-content: center;
            align-items: center;
        }
        .scramble-correct-letter {
            padding: 5px;
            font-size: 1.5em;
            font-weight: bold;
            color: #004d40;
            background-color: #e0f2f1;
            border: 1px solid #b2dfdb;
            border-radius: 5px;
        }

        /* Section 7: Find the object */
        .find-object-container {
            position: relative;
            cursor: crosshair;
            margin-top: 20px;
            border: 2px solid #00796b;
            border-radius: 10px;
            overflow: hidden;
            max-width: 800px;
        }
        .find-object-container img {
            width: 100%;
            height: auto;
            display: block;
        }
        .highlight-area {
            position: absolute;
            background-color: rgba(255, 255, 0, 0.4);
            border: 2px dashed #ffeb3b;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .highlight-area.active {
            opacity: 1;
        }
        .find-object-word-list {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .found-object-word {
            text-decoration: line-through;
            color: #9e9e9e;
        }
        .check-button {
            padding: 10px 20px;
            margin-top: 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 10px;
        }

        footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #616161;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ôn tập từ vựng: Lớp học</h1>

        <div class="star-container" id="star-container">
            <span class="star" id="star1">★</span>
            <span class="star" id="star2">★</span>
            <span class="star" id="star3">★</span>
            <span class="star" id="star4">★</span>
            <span class="star" id="star5">★</span>
            <span class="star" id="star6">★</span>
        </div>

        <div class="nav-buttons">
            <button class="nav-button" onclick="showSection(0)">Từ vựng</button>
            <button class="nav-button" onclick="showSection(1)">Nối từ</button>
            <button class="nav-button" onclick="showSection(2)">Điền từ</button>
            <button class="nav-button" onclick="showSection(3)">Tìm ô chữ</button>
            <button class="nav-button" onclick="showSection(4)">Trắc nghiệm</button>
            <button class="nav-button" onclick="showSection(5)">Sắp xếp từ</button>
            <button class="nav-button" onclick="showSection(6)">Tìm đồ vật</button>
        </div>

        <div id="section1" class="section active">
            <h2>Học từ vựng</h2>
            <div class="vocabulary-grid" id="vocab-list"></div>
        </div>

        <div id="section2" class="section">
            <h2>Nối tranh với từ vựng</h2>
            <p>Kéo từ vào hình ảnh tương ứng.</p>
            <div class="match-container">
                <div class="match-words" id="match-words-container"></div>
                <div class="match-images" id="match-images-container"></div>
            </div>
            <button class="check-button" onclick="checkMatch()">Kiểm tra</button>
        </div>

        <div id="section3" class="section">
            <h2>Điền từ còn thiếu</h2>
            <p>Điền các chữ cái còn thiếu để hoàn thành từ vựng.</p>
            <div class="fill-in-container">
                <div id="fill-in-word-container"></div>
                <button class="check-button" onclick="checkFillIn()">Kiểm tra</button>
            </div>
        </div>

        <div id="section4" class="section">
            <h2>Tìm ô chữ</h2>
            <p>Tìm và khoanh các từ trong danh sách.</p>
            <div class="word-search-container">
                <div id="word-search-grid" class="word-search-grid"></div>
                <div id="word-search-words" class="word-search-word-list"></div>
            </div>
            <button class="check-button" onclick="checkWordSearch()">Kiểm tra</button>
        </div>

        <div id="section5" class="section">
            <h2>Trắc nghiệm</h2>
            <p>Chọn từ đúng với hình ảnh.</p>
            <div class="quiz-container">
                <div id="quiz-question" class="quiz-question"></div>
                <div id="quiz-options" class="quiz-options"></div>
            </div>
        </div>

        <div id="section6" class="section">
            <h2>Sắp xếp từ</h2>
            <p>Sắp xếp các chữ cái để tạo thành từ đúng.</p>
            <div class="scramble-container">
                <p id="scramble-hint"></p>
                <div id="scramble-letters" class="scramble-letters"></div>
                <div id="scramble-target" class="scramble-target-word"></div>
                <button class="check-button" onclick="checkScramble()">Kiểm tra</button>
            </div>
        </div>

        <div id="section7" class="section">
            <h2>Tìm đồ vật</h2>
            <p>Nhấp vào các đồ vật đã học trong tranh.</p>
            <div class="find-object-container" id="find-object-game">
                <img src="https://drive.google.com/uc?id=19eeR1Q0B6ThXijqz29WpgZH2qDyTeBWV" alt="Find the objects">
            </div>
            <div id="find-object-words" class="find-object-word-list"></div>
        </div>
    </div>

    <footer>
        <p>Tài liệu được tạo bởi: Mẹ Khánh An</p>
    </footer>

    <script>
        const vocabulary = [
            { word: 'teacher', icon: '👩‍🏫', image: 'https://cdn-icons-png.flaticon.com/512/3673/3673516.png' },
            { word: 'pupils', icon: '👧', image: 'https://cdn-icons-png.flaticon.com/512/3688/3688129.png' },
            { word: 'school', icon: '🏫', image: 'https://cdn-icons-png.flaticon.com/512/1004/1004122.png' }
        ];

        const audio = new Audio();
        const stars = document.querySelectorAll('.star');
        let completedSections = new Set();
        let currentSectionIndex = 0;

        function playAudio(word) {
            audio.src = `https://api.dictionaryapi.dev/api/v2/entries/en/${word}`;
            audio.onloadeddata = () => {
                const phonetic = audio.src.json()[0].phonetics.find(p => p.audio);
                if (phonetic) {
                    new Audio(phonetic.audio).play();
                } else {
                    console.error("No audio found for this word.");
                }
            };
            audio.load();
        }

        async function speakWord(word) {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function showSection(index) {
            const sections = document.querySelectorAll('.section');
            sections.forEach((sec, i) => {
                sec.classList.remove('active');
                if (i === index) {
                    sec.classList.add('active');
                }
            });
            currentSectionIndex = index;
            if (index === 0) renderVocabulary();
            if (index === 1) renderMatch();
            if (index === 2) renderFillIn();
            if (index === 3) renderWordSearch();
            if (index === 4) renderQuiz();
            if (index === 5) renderScramble();
            if (index === 6) renderFindObject();
        }

        function markStarCompleted(index) {
            completedSections.add(index);
            const completedStars = document.querySelectorAll('.star.completed').length;
            if (completedStars < completedSections.size) {
                stars[index].classList.add('completed');
            }
        }

        // Section 1: Vocabulary
        function renderVocabulary() {
            const vocabList = document.getElementById('vocab-list');
            vocabList.innerHTML = '';
            vocabulary.forEach(item => {
                const div = document.createElement('div');
                div.className = 'vocab-item';
                div.innerHTML = `<span class="icon">${item.icon}</span><span class="word">${item.word}</span>`;
                div.onclick = () => speakWord(item.word);
                vocabList.appendChild(div);
            });
            markStarCompleted(0);
        }

        // Section 2: Match
        let matchItems = [];
        let droppedCount = 0;

        function renderMatch() {
            const wordsContainer = document.getElementById('match-words-container');
            const imagesContainer = document.getElementById('match-images-container');
            wordsContainer.innerHTML = '';
            imagesContainer.innerHTML = '';
            matchItems = [...vocabulary];
            shuffleArray(matchItems);

            matchItems.forEach(item => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'draggable-word';
                wordDiv.textContent = item.word;
                wordDiv.draggable = true;
                wordDiv.dataset.word = item.word;
                wordDiv.addEventListener('dragstart', (e) => e.dataTransfer.setData('text/plain', e.target.dataset.word));
                wordsContainer.appendChild(wordDiv);

                const imgDiv = document.createElement('div');
                imgDiv.className = 'image-box';
                imgDiv.dataset.word = item.word;
                imgDiv.innerHTML = `<img src="${item.image}" alt="${item.word}">`;
                imgDiv.addEventListener('dragover', (e) => e.preventDefault());
                imgDiv.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const word = e.dataTransfer.getData('text/plain');
                    if (word === imgDiv.dataset.word) {
                        imgDiv.classList.add('correct');
                        imgDiv.innerHTML = `<span class="match-image-label">${word}</span><img src="${item.image}" alt="${item.word}">`;
                        const wordElement = document.querySelector(`.draggable-word[data-word="${word}"]`);
                        if (wordElement) wordElement.style.display = 'none';
                        droppedCount++;
                    }
                });
                imagesContainer.appendChild(imgDiv);
            });
        }

        function checkMatch() {
            if (droppedCount === vocabulary.length) {
                alert('Chúc mừng, con đã hoàn thành!');
                markStarCompleted(1);
            } else {
                alert('Con hãy thử lại nhé!');
            }
        }

        // Section 3: Fill in the blank
        let currentFillInIndex = 0;

        function renderFillIn() {
            const fillInContainer = document.getElementById('fill-in-word-container');
            fillInContainer.innerHTML = '';
            const word = vocabulary[currentFillInIndex].word;
            const letters = word.split('');
            const hiddenIndices = new Set();
            while (hiddenIndices.size < Math.floor(word.length / 2)) {
                hiddenIndices.add(Math.floor(Math.random() * word.length));
            }

            letters.forEach((letter, index) => {
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.className = 'fill-in-letter';
                if (hiddenIndices.has(index)) {
                    input.dataset.correct = letter;
                } else {
                    input.value = letter;
                    input.readOnly = true;
                }
                fillInContainer.appendChild(input);
            });
        }

        function checkFillIn() {
            const inputs = document.querySelectorAll('#fill-in-word-container input');
            let isCorrect = true;
            inputs.forEach(input => {
                if (input.dataset.correct && input.value.toLowerCase() !== input.dataset.correct.toLowerCase()) {
                    isCorrect = false;
                }
            });

            if (isCorrect) {
                alert('Chúc mừng, con đã hoàn thành!');
                currentFillInIndex++;
                if (currentFillInIndex >= vocabulary.length) {
                    markStarCompleted(2);
                    currentFillInIndex = 0;
                    alert('Con đã hoàn thành toàn bộ bài tập này!');
                }
                renderFillIn();
            } else {
                alert('Con hãy thử lại nhé!');
            }
        }

        // Section 4: Word Search
        const wordSearchGridSize = 10;
        let wordSearchGrid = [];
        let foundWords = new Set();
        let selectedCells = [];

        function generateWordSearchGrid() {
            const words = vocabulary.map(v => v.word.toUpperCase());
            wordSearchGrid = Array(wordSearchGridSize).fill().map(() => Array(wordSearchGridSize).fill(''));
            
            function placeWord(word) {
                let placed = false;
                let attempts = 0;
                while (!placed && attempts < 100) {
                    attempts++;
                    const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';
                    const row = Math.floor(Math.random() * wordSearchGridSize);
                    const col = Math.floor(Math.random() * wordSearchGridSize);

                    if (direction === 'horizontal') {
                        if (col + word.length <= wordSearchGridSize) {
                            let canPlace = true;
                            for (let i = 0; i < word.length; i++) {
                                if (wordSearchGrid[row][col + i] !== '' && wordSearchGrid[row][col + i] !== word[i]) {
                                    canPlace = false;
                                    break;
                                }
                            }
                            if (canPlace) {
                                for (let i = 0; i < word.length; i++) {
                                    wordSearchGrid[row][col + i] = word[i];
                                }
                                placed = true;
                            }
                        }
                    } else { // vertical
                        if (row + word.length <= wordSearchGridSize) {
                            let canPlace = true;
                            for (let i = 0; i < word.length; i++) {
                                if (wordSearchGrid[row + i][col] !== '' && wordSearchGrid[row + i][col] !== word[i]) {
                                    canPlace = false;
                                    break;
                                }
                            }
                            if (canPlace) {
                                for (let i = 0; i < word.length; i++) {
                                    wordSearchGrid[row + i][col] = word[i];
                                }
                                placed = true;
                            }
                        }
                    }
                }
            }
            words.forEach(word => placeWord(word));

            for (let r = 0; r < wordSearchGridSize; r++) {
                for (let c = 0; c < wordSearchGridSize; c++) {
                    if (wordSearchGrid[r][c] === '') {
                        wordSearchGrid[r][c] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }
        }

        function renderWordSearch() {
            generateWordSearchGrid();
            const gridContainer = document.getElementById('word-search-grid');
            gridContainer.innerHTML = '';
            gridContainer.style.gridTemplateColumns = `repeat(${wordSearchGridSize}, 1fr)`;
            
            wordSearchGrid.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'word-search-cell';
                    cellDiv.textContent = cell;
                    cellDiv.dataset.row = rowIndex;
                    cellDiv.dataset.col = colIndex;
                    cellDiv.addEventListener('mousedown', startSelection);
                    cellDiv.addEventListener('mouseover', continueSelection);
                    cellDiv.addEventListener('mouseup', endSelection);
                    gridContainer.appendChild(cellDiv);
                });
            });

            const wordList = document.getElementById('word-search-words');
            wordList.innerHTML = '';
            vocabulary.forEach(item => {
                const wordSpan = document.createElement('span');
                wordSpan.id = `word-search-${item.word}`;
                wordSpan.textContent = item.word;
                wordList.appendChild(wordSpan);
                wordList.appendChild(document.createTextNode(' '));
            });
        }

        let isSelecting = false;
        function startSelection(e) {
            isSelecting = true;
            selectedCells = [e.target];
            e.target.classList.add('highlight');
        }

        function continueSelection(e) {
            if (!isSelecting) return;
            const target = e.target;
            if (target.classList.contains('word-search-cell')) {
                const lastCell = selectedCells[selectedCells.length - 1];
                const startRow = parseInt(selectedCells[0].dataset.row);
                const startCol = parseInt(selectedCells[0].dataset.col);
                const currentRow = parseInt(target.dataset.row);
                const currentCol = parseInt(target.dataset.col);
                
                // Only allow horizontal or vertical
                if (startRow === currentRow || startCol === currentCol) {
                    if (!selectedCells.includes(target)) {
                        selectedCells.push(target);
                        target.classList.add('highlight');
                    }
                }
            }
        }

        function endSelection() {
            if (!isSelecting) return;
            isSelecting = false;
            
            const selectedWord = selectedCells.map(cell => cell.textContent).join('');
            const foundVocab = vocabulary.find(item => item.word.toUpperCase() === selectedWord.toUpperCase());
            
            if (foundVocab && !foundWords.has(foundVocab.word)) {
                foundWords.add(foundVocab.word);
                selectedCells.forEach(cell => cell.classList.add('found'));
                document.getElementById(`word-search-${foundVocab.word}`).classList.add('found-word');
                alert(`Tìm thấy từ: ${foundVocab.word}!`);
                if (foundWords.size === vocabulary.length) {
                    alert('Chúc mừng, con đã tìm thấy tất cả các từ!');
                    markStarCompleted(3);
                }
            } else {
                selectedCells.forEach(cell => cell.classList.remove('highlight'));
            }
            selectedCells = [];
        }

        function checkWordSearch() {
            if (foundWords.size === vocabulary.length) {
                alert('Con đã hoàn thành bài này rồi!');
            } else {
                alert(`Con còn thiếu ${vocabulary.length - foundWords.size} từ nữa. Cố lên nhé!`);
            }
        }


        // Section 5: Quiz
        let currentQuizIndex = 0;
        let quizWords = [...vocabulary];

        function renderQuiz() {
            const questionContainer = document.getElementById('quiz-question');
            const optionsContainer = document.getElementById('quiz-options');
            questionContainer.innerHTML = '';
            optionsContainer.innerHTML = '';

            shuffleArray(quizWords);
            const question = quizWords[currentQuizIndex];
            
            const img = document.createElement('img');
            img.src = question.image;
            img.alt = question.word;
            questionContainer.appendChild(img);

            const options = new Set();
            options.add(question.word);
            while (options.size < 3) {
                const randomWord = vocabulary[Math.floor(Math.random() * vocabulary.length)].word;
                options.add(randomWord);
            }

            const shuffledOptions = Array.from(options);
            shuffleArray(shuffledOptions);

            shuffledOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option';
                btn.textContent = option;
                btn.onclick = () => checkQuiz(btn, option, question.word);
                optionsContainer.appendChild(btn);
            });
        }

        function checkQuiz(button, selected, correct) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(btn => btn.disabled = true);

            if (selected === correct) {
                button.classList.add('correct');
                speakWord(correct);
                setTimeout(() => {
                    currentQuizIndex++;
                    if (currentQuizIndex >= quizWords.length) {
                        alert('Chúc mừng, con đã hoàn thành toàn bộ bài trắc nghiệm!');
                        markStarCompleted(4);
                        currentQuizIndex = 0;
                        renderQuiz();
                    } else {
                        renderQuiz();
                    }
                }, 1500);
            } else {
                button.classList.add('incorrect');
                const correctBtn = document.querySelector(`.quiz-option[data-correct="true"]`);
                setTimeout(() => {
                    button.classList.remove('incorrect');
                    options.forEach(btn => btn.disabled = false);
                }, 1500);
            }
        }

        // Section 6: Scramble
        let currentScrambleIndex = 0;
        let scrambleWords = [...vocabulary];
        let currentDraggedLetter = null;

        function renderScramble() {
            const lettersContainer = document.getElementById('scramble-letters');
            const targetContainer = document.getElementById('scramble-target');
            lettersContainer.innerHTML = '';
            targetContainer.innerHTML = '';

            const word = scrambleWords[currentScrambleIndex].word;
            const shuffledLetters = word.split('').sort(() => Math.random() - 0.5);

            document.getElementById('scramble-hint').textContent = `Gợi ý: ${scrambleWords[currentScrambleIndex].icon}`;

            shuffledLetters.forEach(letter => {
                const span = document.createElement('span');
                span.className = 'scramble-letter';
                span.textContent = letter;
                span.draggable = true;
                span.addEventListener('dragstart', (e) => {
                    currentDraggedLetter = e.target;
                    setTimeout(() => e.target.style.opacity = '0.5', 0);
                });
                span.addEventListener('dragend', (e) => e.target.style.opacity = '1');
                lettersContainer.appendChild(span);
            });

            targetContainer.addEventListener('dragover', (e) => e.preventDefault());
            targetContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                if (currentDraggedLetter) {
                    const span = document.createElement('span');
                    span.className = 'scramble-correct-letter';
                    span.textContent = currentDraggedLetter.textContent;
                    targetContainer.appendChild(span);
                    currentDraggedLetter.parentNode.removeChild(currentDraggedLetter);
                    currentDraggedLetter = null;
                }
            });
        }

        function checkScramble() {
            const targetContainer = document.getElementById('scramble-target');
            const enteredWord = Array.from(targetContainer.children).map(span => span.textContent).join('');
            const correctWord = scrambleWords[currentScrambleIndex].word;

            if (enteredWord.toLowerCase() === correctWord.toLowerCase()) {
                alert('Chúc mừng, con đã sắp xếp đúng!');
                speakWord(correctWord);
                currentScrambleIndex++;
                if (currentScrambleIndex >= scrambleWords.length) {
                    markStarCompleted(5);
                    currentScrambleIndex = 0;
                    alert('Con đã hoàn thành toàn bộ bài tập này!');
                }
                renderScramble();
            } else {
                alert('Con hãy thử lại nhé!');
            }
        }

        // Section 7: Find the object
        const findObjects = [
            { word: 'teacher', coords: { x: 0.35, y: 0.40, w: 0.15, h: 0.30 }, found: false },
            { word: 'pupils', coords: { x: 0.70, y: 0.50, w: 0.10, h: 0.15 }, found: false },
            { word: 'school', coords: { x: 0.10, y: 0.75, w: 0.15, h: 0.15 }, found: false }
        ];

        function renderFindObject() {
            const gameContainer = document.getElementById('find-object-game');
            const img = gameContainer.querySelector('img');
            const wordsContainer = document.getElementById('find-object-words');
            wordsContainer.innerHTML = '';
            findObjects.forEach(obj => {
                const span = document.createElement('span');
                span.id = `find-word-${obj.word}`;
                span.textContent = obj.word;
                wordsContainer.appendChild(span);
                wordsContainer.appendChild(document.createTextNode(' '));
            });

            gameContainer.onclick = (e) => {
                const rect = img.getBoundingClientRect();
                const clickX = (e.clientX - rect.left) / rect.width;
                const clickY = (e.clientY - rect.top) / rect.height;

                findObjects.forEach(obj => {
                    if (!obj.found) {
                        const { x, y, w, h } = obj.coords;
                        if (clickX > x && clickX < x + w && clickY > y && clickY < y + h) {
                            alert(`Con đã tìm thấy: ${obj.word}!`);
                            obj.found = true;
                            speakWord(obj.word);
                            document.getElementById(`find-word-${obj.word}`).classList.add('found-object-word');
                            
                            const highlight = document.createElement('div');
                            highlight.className = 'highlight-area active';
                            highlight.style.left = `${x * 100}%`;
                            highlight.style.top = `${y * 100}%`;
                            highlight.style.width = `${w * 100}%`;
                            highlight.style.height = `${h * 100}%`;
                            gameContainer.appendChild(highlight);
                        }
                    }
                });
                if (findObjects.every(obj => obj.found)) {
                    alert('Chúc mừng, con đã tìm thấy tất cả các đồ vật!');
                    markStarCompleted(6);
                }
            };
        }
        
        // Helper function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            showSection(0);
        });
    </script>

</body>
</html>